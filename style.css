document.addEventListener('DOMContentLoaded', function() {
    const flipbook = document.getElementById('flipbook');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const currentPageSpan = document.getElementById('current-page');
    const totalPagesSpan = document.getElementById('total-pages');
    
    // Páginas do flipbook (capa + 5 páginas + contracapa)
    const pages = [
        'cover', 'page1', 'page2', 'page3', 'page4', 'page5', 'back-cover'
    ];
    
    let currentPageIndex = 0;
    const totalPages = pages.length;
    totalPagesSpan.textContent = totalPages - 1; // Excluindo a capa na contagem
    
    // Atualiza a exibição da página atual
    function updatePage() {
        // Oculta todas as páginas
        pages.forEach(pageId => {
            document.getElementById(pageId).style.display = 'none';
        });
        
        // Exibe a página atual
        document.getElementById(pages[currentPageIndex]).style.display = 'flex';
        currentPageSpan.textContent = Math.max(1, currentPageIndex);
        
        // Atualiza estado dos botões
        prevBtn.disabled = currentPageIndex === 0;
        nextBtn.disabled = currentPageIndex === totalPages - 1;
    }
    
    // Anima a virada de página
    function flipPage(direction) {
        // Adiciona a classe de animação
        flipbook.classList.add('flipping');
        
        setTimeout(() => {
            // Atualiza a página atual
            if (direction === 'next' && currentPageIndex < totalPages - 1) {
                currentPageIndex++;
            } else if (direction === 'prev' && currentPageIndex > 0) {
                currentPageIndex--;
            }
            
            // Atualiza a exibição
            updatePage();
            
            // Remove a classe de animação
            flipbook.classList.remove('flipping');
        }, 500);
    }
    
    // Event listeners para os botões
    prevBtn.addEventListener('click', () => flipPage('prev'));
    nextBtn.addEventListener('click', () => flipPage('next'));
    
    // Navegação por teclado
    document.addEventListener('keydown', function(e) {
        if (e.key === 'ArrowLeft' && currentPageIndex > 0) {
            flipPage('prev');
        } else if (e.key === 'ArrowRight' && currentPageIndex < totalPages - 1) {
            flipPage('next');
        }
    });
    
    // Navegação por toque (swipe)
    let touchStartX = 0;
    
    flipbook.addEventListener('touchstart', function(e) {
        touchStartX = e.changedTouches[0].screenX;
    }, false);
    
    flipbook.addEventListener('touchend', function(e) {
        const touchEndX = e.changedTouches[0].screenX;
        const diff = touchEndX - touchStartX;
        
        // Verifica se o movimento foi significativo
        if (Math.abs(diff) > 50) {
            if (diff < 0 && currentPageIndex < totalPages - 1) {
                flipPage('next'); // Swipe para esquerda
            } else if (diff > 0 && currentPageIndex > 0) {
                flipPage('prev'); // Swipe para direita
            }
        }
    }, false);
    
    // Inicializa o flipbook
    updatePage();
});
